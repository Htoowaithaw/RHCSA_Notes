# 📀 Rocky Linux 9.6 — Create a Local DVD/ISO Repository (Clear, Step-by-Step)

## 🧠 Goal (Why you’re doing this)
Install packages **without internet** by pointing `dnf` to a **local repository** built from the Rocky Linux **9.6 DVD ISO**.

---

## ✅ What you’ll do (high level)
1) Install the repo tool `createrepo_c`  
2) Mount the Rocky 9.6 ISO  
3) Copy **BaseOS** and **AppStream** RPMs to `/localrepo` (both are needed for deps)  
4) Generate repo metadata with `createrepo_c`  
5) Add a repo file at `/etc/yum.repos.d/local.repo` (using **vi**, not nano)  
6) Clean cache, verify repo, test install

---

## 🧩 Command cheats (so you don’t forget)
- `df -h /` → **Disk Free (human)**: shows free/used space on `/` (root FS).  
  *Why*: Ensure you have enough space **before** copying gigabytes of RPMs.
- `du -sh .` → **Disk Usage (summary, human)** of the **current directory**.  
  *Why*: See how big the source folder (e.g., `Packages/`) is before copying.
- `cp -v` → **Copy (verbose)**: prints each file as it’s copied.  
- `createrepo_c /path` → Scans RPMs in `/path`, creates metadata so `dnf` can treat it as a repo.  
- `dnf clean all` → Clears cached metadata so `dnf` reads your **new** repo.  
- `dnf repolist all` → Lists all repos and their status (enabled/disabled).  
- **vi basics**: open file → `vi file`; insert mode → press `i`; save & quit → press `Esc`, type `:wq`, then `Enter`.

---

## 🛠️ Steps (with explanations)

### 1) Install the tool that builds repo metadata
```sh
sudo dnf install -y createrepo_c

    Installs createrepo_c, which creates the metadata (repodata/) that dnf needs.

2) Attach & mount the Rocky 9.6 DVD ISO

    In your hypervisor (VirtualBox/VMware): Devices → Optical Drives → Choose Disk → select Rocky-9.6-x86_64-dvd1.iso.

    It usually auto-mounts under /run/media/<your_user>/Rocky-9-6....

Verify the mount and free space:

df -h

    Look for a line like /dev/sr0 ... /run/media/<user>/Rocky-9-6_x86_64.

    Also check root FS space (line with mountpoint /). You’ll need ~10–15 GB free.

If it didn’t mount automatically:

sudo mount /dev/cdrom /mnt

    Then your ISO’s content is under /mnt.

3) Create a local repo directory

sudo mkdir -p /localrepo

    This is where you’ll store RPMs and repo metadata.

4) Copy RPMs from both BaseOS and AppStream

    Why both? Real installs need dependencies from BaseOS and AppStream. Copying only one often breaks dependencies.

First, check size of AppStream/Packages and BaseOS/Packages on the ISO:

cd /run/media/<your_user>/Rocky-9-6*/AppStream/Packages
du -sh .
cd /run/media/<your_user>/Rocky-9-6*/BaseOS/Packages
du -sh .

    du -sh . tells you how big each source is, so you can confirm you have enough space.

Now copy AppStream and BaseOS packages into one local folder:

sudo cp -v /run/media/<your_user>/Rocky-9-6*/AppStream/Packages/* /localrepo/
sudo cp -v /run/media/<your_user>/Rocky-9-6*/BaseOS/Packages/*   /localrepo/

    cp -v shows progress; optionally use nohup/screen for long copies.

Double-check how big /localrepo is after copy:

cd /localrepo
du -sh .

5) Build the repository metadata

sudo createrepo_c /localrepo

    Creates /localrepo/repodata with indexes so dnf can read the repo.

If you add or remove RPMs later, run createrepo_c again.
6) Add a repo file (with vi)

Open the file:

sudo vi /etc/yum.repos.d/local.repo

Press i (insert), paste the block below, then Esc :wq Enter to save.

[RockyLinux9-Local]
name=Rocky Linux 9.6 Local Repo
baseurl=file:///localrepo
enabled=1
gpgcheck=0

    baseurl=file:///localrepo → file:// means “read from local filesystem”.

    enabled=1 → turn it on.

    gpgcheck=0 → skip GPG signature checks (OK for lab/testing).
    Safer (optional): import Rocky GPG keys and set gpgcheck=1.

    Tip (be careful): Don’t delete your internet repos. If you want local-only installs, temporarily disable others:

    sudo dnf config-manager --set-disabled \*
    sudo dnf config-manager --set-enabled RockyLinux9-Local

    (You may need dnf-plugins-core: sudo dnf install -y dnf-plugins-core.)

7) Clear cache and verify the repo is seen

sudo dnf clean all
sudo dnf repolist all

    dnf clean all removes old metadata so dnf loads your new local repo.

    dnf repolist all should show:

    RockyLinux9-Local   Rocky Linux 9.6 Local Repo   enabled

8) Test install (no internet needed)

sudo dnf install -y httpd

    If it installs from RockyLinux9-Local without reaching the internet, your local repo works.

🧪 Quick sanity checks & troubleshooting

    No space errors:

        Check free space: df -h /

        Check source size: du -sh /run/media/<user>/Rocky-9-6*/{AppStream,BaseOS}/Packages

    dnf can’t see the repo:

        Rebuild metadata: sudo createrepo_c /localrepo

        Clean cache: sudo dnf clean all

        Confirm .repo file and enabled=1: vi /etc/yum.repos.d/local.repo

        Verify: sudo dnf repolist all

    Deps missing:

        Ensure you copied both AppStream and BaseOS packages.

        Re-run createrepo_c and dnf clean all.

    GPG errors (if gpgcheck=1):

        Import keys: sudo rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-rockyofficial (or from the ISO), then try again.

🔁 One-screen recap (do this in order)

sudo dnf install -y createrepo_c
df -h /                                # check free space on root
sudo mkdir -p /localrepo
sudo cp -v /run/media/<u>/Rocky-9-6*/AppStream/Packages/* /localrepo/
sudo cp -v /run/media/<u>/Rocky-9-6*/BaseOS/Packages/*   /localrepo/
sudo createrepo_c /localrepo
sudo vi /etc/yum.repos.d/local.repo    # add the 5-line block, save with :wq
sudo dnf clean all
sudo dnf repolist all
sudo dnf install -y httpd

    Replace <u> with your username in the paths.

🏁 Key takeaways (memory anchors)

    Both AppStream and BaseOS are needed for dependencies.

    du -sh . = “How big is this folder?” (summary, human)

    df -h / = “How much free space is on root filesystem?” (human)

    createrepo_c /localrepo = “Make /localrepo look like a real repo to dnf.”

    Always dnf clean all after changing repos.